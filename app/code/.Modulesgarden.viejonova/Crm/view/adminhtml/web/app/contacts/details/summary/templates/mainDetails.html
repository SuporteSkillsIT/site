<div class="box light bordered" ng-class="{'toogled': toogled }">
    <div class="box-title">
        <div class="caption">
            <span class="bold font-blue-steel uppercase">

                {{ 'resource.summary.widget.main' | translate }}
            </span>
            <span class="caption-helper">
                {{ 'resource.summary.widget.main.descr' | translate }}
            </span>
        </div>
        <div class="actions">
            <a href="#" ng-show="toogled" ng-click="toogled = !toogled" class="btn btn-sm btn-danger btn-circle btn-outline btn-inverse btn-transparent btn-icon-only">
                <i class="fa fa-expand"></i>
            </a>
            <a href="#" ng-hide="toogled" ng-click="toogled = !toogled" class="btn btn-sm btn-danger btn-circle btn-outline btn-inverse btn-transparent btn-icon-only">
                <i class="fa fa-compress"></i>
            </a>
        </div>
    </div>
    <div class="box-body crm-customfields-form">
        <div class="form-group showOnMouseOverContainer row row-eq-height">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.assignedclient' | translate }}
            </label>
            <div class="col-sm-8">
                <span ng-show="modalFormProgress" class="mg-loader-flow active" style="position: relative; top: 5px;"></span>

                <span class="formatedValue" ng-hide="openReassignClientOppened">
                    <a ng-if="mainData.client" ng-href="{{ customerViewUrl }}{{ mainData.client.entity_id}}" target="_blank">
                        #{{ mainData.client.entity_id}} {{ mainData.client.firstname}} {{ mainData.client.lastname}}
                    </a>

                    <small ng-if="!mainData.client" class="text-muted">{{ 'text.not.assigned' | translate }}</small>

                    <span 
                        class="icon-pencil showOnMouseOver editable-pencil right" 
                        ng-if="hasAccess('resources.assign_client')"
                        ng-click="openReassignClient()"></span>
                    <a ng-href="{{ createCustomerUrl }}" ng-click="setSessionResourceId()" target="_blank" ng-show="!mainData.client"  class="btn btn-xs btn-primary pull-right margin-right-10 showOnMouseOver">{{ 'resource.summary.main.client.create' | translate }}</a>
                </span>

                <form name="reasignClientForm" ng-show="openReassignClientOppened && !modalFormProgress" novalidate ng-submit="reasignClientFormSubmit(unassign)" role="form" class="form-horizontal">

                    <ui-select ng-model="$parent.$parent.selectedClient" on-select="$parent.clientToReassignSelected=true">
                        <ui-select-match placeholder="{{ 'resource.create.select.client' | translate }}">{{ $select.selected.name }}</ui-select-match>
                        <ui-select-choices repeat="client in searchedClients"
                              refresh="refreshClients($select.search)"
                              refresh-delay="0">
                          <div ng-bind-html="('<b>#'+client.entity_id + '</b> ' + client.name) | highlight: $select.search"></div>
                        </ui-select-choices>
                    </ui-select>


                    <div class="control-label" style="text-align: left; padding-bottom: 0;" ng-hide="!mainData.client_id">
                        <label>
                            <input type="checkbox" name="active" id="forceunassign" ng-model="unassign" value="unassign" name="active"> 
                            {{ 'resource.summary.main.unassignclient' | translate }}
                        </label>
                    </div>

                    <span class="editable-buttons btn-group margin-bottom-5 margin-top-5" ng-show="clientToReassignSelected || unassign">
                        <button type="submit" class="btn btn-success btn-icon-only btn-sm">
                            <span class="fa fa-check"></span>
                        </button>
                        <button type="button" class="btn btn-danger btn-icon-only btn-sm" ng-click="openReassignClientOppened = false;">
                            <span class="fa fa-times"></span>
                        </button>

                    </span>

                    <div class="clearfix"></div>

                </form>

            </div>
            <div class="clearfix"></div>
        </div>

        <div class="form-group showOnMouseOverContainer row row-eq-height">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.email' | translate }}
            </label>
            <div class="col-sm-8">

                <span ng-hide="mainLeadEmailXeditable.$waiting" class="showOnMouseOverContainer">
                    <span ng-hide="mainLeadEmailXeditable.$waiting" editable-email="mainData.email" e-form="mainLeadEmailXeditable" ng-model="mainData.email" onbeforesave="updateStatic('email', $data)" onaftersave="setUpTargetEmailsToForm()">
                        <span class="formatedValue">

                            <span ng-show="mainData.email">{{ mainData.email}}</span>
                            <small ng-hide="mainData.email" class="text-muted">{{ ::('text.not.set' | translate) }}</small>

                            <span class="icon-pencil showOnMouseOver editable-pencil" ng-click="mainLeadEmailXeditable.$show()"></span>
                            <a ui-sref="contacts.details.emails({id: mainData.id })" ng-show="mainData.email" class="btn btn-xs btn-icon-only btn-primary pull-right margin-right-10 showOnMouseOver"><i class="icon-envelope-letter"></i></a>
                        </span>
                    </span>
                </span>

                <span ng-show="mainLeadEmailXeditable.$waiting" class="mg-loader-flow active" style="position: relative; top: 5px;"></span>

            </div>
            <div class="clearfix"></div>
        </div>

        <div class="form-group showOnMouseOverContainer row row-eq-height">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.phone' | translate }}
            </label>
            <div class="col-sm-8">

                <span ng-hide="mainLeadPhoneXeditable.$waiting" class="showOnMouseOverContainer">
                    <span ng-hide="mainLeadPhoneXeditable.$waiting" editable-text="mainData.phone" e-form="mainLeadPhoneXeditable" ng-model="mainData.phone" onbeforesave="updateStatic('phone', $data)">
                        <span class="formatedValue">

                            <span ng-show="mainData.phone">{{ mainData.phone}}</span>
                            <small ng-hide="mainData.phone" class="text-muted">{{ ::('text.not.set' | translate) }}</small>

                            <span class="icon-pencil showOnMouseOver editable-pencil" ng-click="mainLeadPhoneXeditable.$show()"></span>
                            <a ng-click="openAsterishWidget(mainData.phone)" ng-show="mainData.phone && settings.config.integrations.asterisk" class="btn btn-xs btn-icon-only btn-primary pull-right margin-right-10 showOnMouseOver"><i class="icon-call-end"></i></a>
                        </span>
                    </span>
                </span>
                <span ng-show="mainLeadPhoneXeditable.$waiting" class="mg-loader-flow active" style="position: relative; top: 5px;"></span>


            </div>
            <div class="clearfix"></div>
        </div>

        <div class="form-group showOnMouseOverContainer row row-eq-height">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.type' | translate }}
            </label>
            <div class="col-sm-8">
                <span class="formatedValue">
                    <span ng-show="contactType.name" class="label label-sm" ng-style="{'background-color': contactType.color}">
                        {{ contactType.name}}
                    </span>
                    <i ng-show="contactType.icon" ng-class="contactType.icon" class="pull-right"></i>
                </span>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="form-group showOnMouseOverContainer row row-eq-height">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.campaign' | translate }}
            </label>
            <div class="col-sm-8">

                <span ng-hide="mainLeadCampaignXeditable.$waiting">
                    <span 
                        ng-hide="mainLeadCampaignXeditable.$waiting" 
                        editable-select="mainData.campaigns" 
                        e-ng-options="c.id as c.name for c in temp.campaigns | filter:{canAssign:true}:true" 
                        e-multiple
                        e-form="mainLeadCampaignXeditable" 
                        ng-model="field.data.optionsRaw" 
                        onbeforesave="updateAssignedCampaigns($data)"
                        onaftersave="updateAssignedCampaignsInMain()"
                        >
                        <span class="formatedValue">
                            <span class="icon-pencil showOnMouseOver editable-pencil" ng-click="mainLeadCampaignXeditable.$show()"></span>

                            <div ng-repeat="c in filteredCampaigns = (temp.campaigns| filter:campaignIsAssigned:true)" ng-style="$last && {'padding-bottom':'6px'}"><span class="label label-sm" ng-style="c.color && {'background-color': c.color }">{{ c.name}}</span></div>
                            <small ng-hide="filteredCampaigns.length" class="text-muted">{{ ::('text.not.assigned' | translate) }}</small>

                        </span>
                    </span>

                </span>
                <span ng-show="mainLeadCampaignXeditable.$waiting" class="mg-loader-flow active" style="position: absolute; top: -3px;"></span>

            </div>
            <div class="clearfix"></div>
        </div>

        <div class="form-group row row-eq-height">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.created' | translate }}
            </label>
            <div class="col-sm-8">
                <span class="formatedValue">
                    {{ mainData.created_at}}
                </span>
            </div>
            <div class="clearfix"></div>
        </div>

        <div class="form-group row row-eq-height" ng-if="mainData.deleted_at">
            <label class="col-sm-4 control-label">
                {{ 'resource.summary.main.deleted' | translate }}
            </label>
            <div class="col-sm-8">
                <span class="formatedValue">
                    {{ mainData.deleted_at}}
                </span>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>

<div class="box light bordered" ng-class="{'toogled': !toogledCampaignNotes }" ng-hide="(temp.campaigns | filter:campaignIsAssigned:true).length == 0">
    <div class="box-title">
        <div class="caption">
            <span class="bold font-green-grey uppercase">
                {{ ::('resource.summary.main.campaign.notes' | translate) }}
            </span>
            <span class="caption-helper">
                {{ ::('resource.summary.main.campaign.notes.descr' | translate) }}
            </span>
        </div>
        <div class="actions">
            <a href="#" ng-show="toogledCampaignNotes" ng-click="toogledCampaignNotes = !toogledCampaignNotes" class="btn btn-sm btn-danger btn-circle btn-outline btn-inverse btn-transparent btn-icon-only">
                <i class="fa fa-compress"></i>
            </a>
            <a href="#" ng-hide="toogledCampaignNotes" ng-click="toogledCampaignNotes = !toogledCampaignNotes" class="btn btn-sm btn-danger btn-circle btn-outline btn-inverse btn-transparent btn-icon-only">
                <i class="fa fa-expand"></i>
            </a>
        </div>
    </div>
    <div class="box-body crm-customfields-form">

        <div class="row" ng-repeat="c in filteredCampaigns = (temp.campaigns| filter:campaignIsAssigned:true)">
            <div class="form-group">
                <label class="col-sm-12 control-label" style="text-align: left;">
                    <span ng-style="c.color && {'color': c.color }">
                        {{ c.name}}
                    </span>
                </label>
                <div class="clearfix"></div>
            </div>
            <div class="col-sm-12" ng-class="$last ? 'margin-bottom-10' : 'margin - bottom - 20'" style="padding-top: 5px;" ng-bind-html="c.description"></div>
        </div>
    </div>
</div>